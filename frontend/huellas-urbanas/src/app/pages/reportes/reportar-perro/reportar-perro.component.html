<div class="container mx-auto px-4 py-8 font-display">
  <h2 class="text-3xl font-bold mb-8">Reportar un perro callejero</h2>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Fotos -->
    <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow border">
      <h3 class="text-lg font-bold mb-4">Fotos del perro</h3>

      <div *ngIf="imagenPreview; else sinImagen"
        class="aspect-video w-full bg-gray-100 rounded-lg bg-cover bg-center mb-4"
        [style.background-image]="'url(' + imagenPreview + ')'"></div>
      <ng-template #sinImagen>
        <div class="aspect-video w-full bg-gray-100 rounded-lg flex items-center justify-center mb-4">
          <span class="text-gray-500">Sin imagen seleccionada</span>
        </div>
      </ng-template>

      <label for="imagenInput"
        class="w-full flex items-center justify-center gap-2 bg-primary/20 hover:bg-primary/30 text-primary font-bold py-3 px-4 rounded-lg cursor-pointer transition-colors">
        <span class="material-symbols-outlined">upload_file</span>
        <span>Subir foto</span>
      </label>
      <input id="imagenInput" type="file" (change)="onImageSelected($event)" hidden />
    </div>

    <!-- Descripción y ubicación -->
    <div class="flex flex-col gap-6">
      <!-- Descripción -->
      <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow border">
        <h3 class="text-lg font-bold mb-4">Descripción</h3>
        <textarea [(ngModel)]="descripcion"
          class="form-textarea w-full resize-none rounded-lg bg-background-light dark:bg-background-dark border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary min-h-[120px]"
          placeholder="Describe al perro (color, tamaño, estado físico, comportamiento, etc.)"></textarea>
      </div>

      <!-- Estado del perro -->
      <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow border">
        <h3 class="text-lg font-bold mb-4">Estado del perro</h3>
        <select [(ngModel)]="estado"
          class="form-select w-full rounded-lg bg-background-light dark:bg-background-dark border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary">
          <option value="SIN_RESCATAR">Sin rescatar</option>
          <option value="HERIDO">Herido</option>
        </select>
      </div>


      <!-- Dirección -->
      <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow border">
        <h3 class="text-lg font-bold mb-4">Dirección o referencia</h3>
        <input [(ngModel)]="direccion" id="direccion" placeholder="Ejemplo: Calle 10 #23-45, cerca al parque principal"
          class="form-input w-full rounded-lg bg-background-light dark:bg-background-dark border-gray-300 dark:border-gray-700 mb-4"
          type="text" />
      </div>

      <!-- Mapa -->
      <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow border flex flex-col justify-between"
        style="min-height: 460px;">
        <div>
          <h3 class="text-lg font-bold mb-4">Selecciona la ubicación en el mapa</h3>

          <!-- Contenedor del mapa -->
          <!-- DEBUG: background + outline temporal para comprobar visibilidad -->
          <div id="mapa" class="w-full h-72 rounded-lg mb-4 border border-gray-300 dark:border-gray-700 shadow-inner"
            style="min-height: 300px; background: rgba(0,0,0,0.03); outline: 2px dashed rgba(255,0,0,0.4);"></div>
        </div>

        <!-- Botón: Usar mi ubicación -->
        <div class="flex justify-center mt-4">
          <button (click)="usarMiUbicacion()"
            class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md w-full sm:w-auto"
            style="margin-top: 50px;">
            <span class="material-symbols-outlined">my_location</span>
            <span>Usar mi ubicación</span>
          </button>
        </div>

        <!-- Coordenadas -->
        <div class="mt-4 text-sm text-gray-700 dark:text-gray-300 text-center">
          <p><strong>Latitud:</strong> {{ latitud || 'No seleccionada' }}</p>
          <p><strong>Longitud:</strong> {{ longitud || 'No seleccionada' }}</p>
        </div>
      </div>


      <!-- Botón de enviar -->
      <button (click)="enviarReporte()" [disabled]="cargando"
        class="w-full bg-primary hover:bg-opacity-90 text-black font-bold py-4 px-4 rounded-lg transition-colors text-lg flex items-center justify-center gap-2">
        <span class="material-symbols-outlined">pets</span>
        <span *ngIf="!cargando">Enviar reporte</span>
        <span *ngIf="cargando">Enviando...</span>
      </button>
    </div>
  </div>
</div>